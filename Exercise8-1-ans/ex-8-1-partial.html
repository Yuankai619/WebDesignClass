<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Local Storage</title>
    <title>Local Storage</title>
    <style type="text/CSS">
        table {
            width: 90%;
            border-collapse: collapse;
            background-color: lightblue;
            font-family: Perpetua;
        }

        table, td, th {
            border: 1px solid black;
            padding: 4px;
        }

        th {
            text-align: center;
            color: white;
            background-color: darkblue;
        }

        tr.oddrow {
            background-color: white;
        }

        td {
            text-align: center;
        }
    </style>
    <script type="text/javascript">
        document.getElementById('addButton').addEventListener('click', function() {
            var title = document.getElementById('bookTitle').value;
            var author = document.getElementById('authors').value;
            var year = document.getElementById('year').value;
            var url = document.getElementById('bookURL').value;

            var key = 'ntou-' + new Date().getTime();
            var value = JSON.stringify({ title: title, author: author, year: year, url: url });

            localStorage.setItem(key, value);
            displayItems();
        });

        document.getElementById('removeAllButton').addEventListener('click', function() {
            Object.keys(localStorage).forEach(function(key) {
                if (key.startsWith('ntou-')) {
                    localStorage.removeItem(key);
                }
            });
            alert('All items were removed!');
            displayItems();
        });

        function displayItems() {
            var display = document.getElementById('display');
            display.innerHTML = ''; 
            var markup="<table<table>"
            var table = document.createElement('table');
            display.appendChild(table);

            var thead = document.createElement('thead');
            table.appendChild(thead);

            var headerRow = document.createElement('tr');
            thead.appendChild(headerRow);

            ['Title', 'Author', 'Year', 'URL'].forEach(function(text) {
                var th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });

            var tbody = document.createElement('tbody');
            table.appendChild(tbody);
            var tmpcnt=1;
            times = Object.keys(localStorage).sort();
            Object.keys(localStorage).forEach(function(key) {
                if (key.startsWith('ntou-')) {
                    var tr = document.createElement('tr');
                    tbody.appendChild(tr);
                    if(tmpcnt%2){
                        tr.className="oddrow";
                    }
                    tmpcnt++;

                    var item = JSON.parse(localStorage.getItem(key));

                    ['title', 'author', 'year', 'url'].forEach(function(field) {
                        var td = document.createElement('td');
                        if (field === 'url') {
                            var a = document.createElement('a');
                            a.href = item[field];
                            a.textContent = item[field];
                            a.target="_blank";
                            td.appendChild(a);
                        } else {
                            td.textContent = item[field];
                        }
                        tr.appendChild(td);
                    });
                }
            });
        }
        // displayItems();
        window.addEventListener("load",displayItems,false);
    </script>
</head>
<body>
    <form action="#">
        <p>
            <label>Book Title: <input type="text" id="bookTitle"></label>
            <label>Author(s): <input type="text" id="authors"></label>
            <label>Year: <input type="number" id="year"></label>
            <label>Book URL: <input type="url" id="bookURL"></label>
        </p>
        <p>
            <input type="button" value="Add New Item" id="addButton">
            <input type="button" value="Remove All Items" id="removeAllButton">
        </p>
    </form>
    <hr>
    <div id="display">
        
    </div>
    <!-- <table><thead><tr><th></th></tr></thead></table> -->
    <script type="text/javascript">
        document.getElementById('addButton').addEventListener('click', function() {
            var title = document.getElementById('bookTitle').value;
            var author = document.getElementById('authors').value;
            var year = document.getElementById('year').value;
            var url = document.getElementById('bookURL').value;
            // if(title)
            var key = 'ntou-' + new Date().getTime();
            var value = JSON.stringify({ title: title, author: author, year: year, url: url });

            localStorage.setItem(key, value);
            displayItems();
        });

        document.getElementById('removeAllButton').addEventListener('click', function() {
            Object.keys(localStorage).forEach(function(key) {
                if (key.startsWith('ntou-')) {
                    localStorage.removeItem(key);
                }
            });
            alert('All items were removed!');
            displayItems();
        });

        function displayItems() {
            var display = document.getElementById('display');
            display.innerHTML = ''; 
            var markup="<table<table>"
            var table = document.createElement('table');
            display.appendChild(table);

            var thead = document.createElement('thead');
            table.appendChild(thead);

            var headerRow = document.createElement('tr');
            thead.appendChild(headerRow);

            ['Title', 'Author', 'Year', 'URL'].forEach(function(text) {
                var th = document.createElement('th');
                th.textContent = text;
                headerRow.appendChild(th);
            });

            var tbody = document.createElement('tbody');
            table.appendChild(tbody);
            var tmpcnt=1;
            Object.keys(localStorage).forEach(function(key) {
                if (key.startsWith('ntou-')) {
                    var tr = document.createElement('tr');
                    tbody.appendChild(tr);
                    if(tmpcnt%2){
                        tr.className="oddrow";
                    }
                    tmpcnt++;

                    var item = JSON.parse(localStorage.getItem(key));

                    ['title', 'author', 'year', 'url'].forEach(function(field) {
                        var td = document.createElement('td');
                        if (field === 'url') {
                            var a = document.createElement('a');
                            a.href = item[field];
                            a.textContent = item[field];
                            td.appendChild(a);
                        } else {
                            td.textContent = item[field];
                        }
                        tr.appendChild(td);
                    });
                }
            });
        }
        displayItems();
    </script>
</body>
</html>
